# Use Node.js 18
FROM node:18-alpine

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm install

# Copy source code
COPY . .

# Accept build arguments from Railway
ARG NEXT_PUBLIC_API_URL
ARG NEXT_PUBLIC_WS_URL
ARG NEXT_PUBLIC_CHAIN_ID
ARG NEXT_PUBLIC_CHAIN_NAME
ARG NEXT_PUBLIC_POLYGON_RPC
ARG NEXT_PUBLIC_PINATA_JWT
ARG NEXT_PUBLIC_PINATA_GATEWAY
ARG NEXT_PUBLIC_IPFS_API_URL
ARG PINATA_API_KEY
ARG PINATA_SECRET_API_KEY
ARG NEXT_PUBLIC_APP_ENV
ARG NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID
ARG NEXT_PUBLIC_ESCROW_CONTRACT
ARG NEXT_PUBLIC_REPUTATION_CONTRACT
ARG NEXT_PUBLIC_STAKING_CONTRACT
ARG NEXT_PUBLIC_PAYMENT_CONTRACT
ARG NEXT_PUBLIC_CMT_TOKEN_CONTRACT
ARG NEXT_PUBLIC_SOCKET_URL
ARG NEXT_TELEMETRY_DISABLED

# Set environment variables to skip linting
ENV SKIP_LINT=true
ENV DISABLE_ESLINT_PLUGIN=true
ENV TSC_COMPILE_ON_ERROR=true

# Set Next.js environment variables for build (Railway build args â†’ ENV)
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
ENV NEXT_PUBLIC_WS_URL=$NEXT_PUBLIC_WS_URL
ENV NEXT_PUBLIC_CHAIN_ID=$NEXT_PUBLIC_CHAIN_ID
ENV NEXT_PUBLIC_CHAIN_NAME=$NEXT_PUBLIC_CHAIN_NAME
ENV NEXT_PUBLIC_POLYGON_RPC=$NEXT_PUBLIC_POLYGON_RPC
ENV NEXT_PUBLIC_PINATA_JWT=$NEXT_PUBLIC_PINATA_JWT
ENV NEXT_PUBLIC_PINATA_GATEWAY=$NEXT_PUBLIC_PINATA_GATEWAY
ENV NEXT_PUBLIC_IPFS_API_URL=$NEXT_PUBLIC_IPFS_API_URL
ENV PINATA_API_KEY=$PINATA_API_KEY
ENV PINATA_SECRET_API_KEY=$PINATA_SECRET_API_KEY
ENV NEXT_PUBLIC_APP_ENV=$NEXT_PUBLIC_APP_ENV
ENV NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID=$NEXT_PUBLIC_WALLET_CONNECT_PROJECT_ID
ENV NEXT_PUBLIC_ESCROW_CONTRACT=$NEXT_PUBLIC_ESCROW_CONTRACT
ENV NEXT_PUBLIC_REPUTATION_CONTRACT=$NEXT_PUBLIC_REPUTATION_CONTRACT
ENV NEXT_PUBLIC_STAKING_CONTRACT=$NEXT_PUBLIC_STAKING_CONTRACT
ENV NEXT_PUBLIC_PAYMENT_CONTRACT=$NEXT_PUBLIC_PAYMENT_CONTRACT
ENV NEXT_PUBLIC_CMT_TOKEN_CONTRACT=$NEXT_PUBLIC_CMT_TOKEN_CONTRACT
ENV NEXT_PUBLIC_SOCKET_URL=$NEXT_PUBLIC_SOCKET_URL
ENV NEXT_TELEMETRY_DISABLED=$NEXT_TELEMETRY_DISABLED

# Build the Next.js app with ESLint disabled
RUN npm run build

# Expose port
EXPOSE 3000

# Start the application
CMD ["npm", "start"]
